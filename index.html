<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大佛顶首楞严神咒 - 赛博律动阅读器</title>
    <meta name="description" content="楞严咒-律动阅读器版，使枯燥无味的经文念诵变的由个人随意发挥创造力">
    <style>
        :root {
            --accent: #00f2ff;
            --glass: rgba(5, 10, 20, 0.85);
            --grid-color: rgba(0, 242, 255, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #000; color: #fff; font-family: "PingFang SC", sans-serif; overflow: hidden; height: 100vh; }

        /* 背景：赛博夜景无限位移 */
        .bg-scroll {
            position: fixed; top: 0; left: 0; width: 200%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1519608487953-e999c86e7455?q=80&w=2070');
            background-size: 50% 100%; background-repeat: repeat-x;
            z-index: -2; animation: scrollBg 25s linear infinite;
        }
        @keyframes scrollBg { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        .grid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 5vw 5vh; opacity: 0.5;
        }

        #app { display: flex; justify-content: center; align-items: center; height: 100vh; width: 100%; }

        /* 卡片样式 */
        .card {
            width: 100%; max-width: 850px; height: 100vh;
            background: var(--glass); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-left: 1px solid rgba(0, 242, 255, 0.2); border-right: 1px solid rgba(0, 242, 255, 0.2);
            padding: 40px 60px; display: none; flex-direction: column; box-shadow: 0 0 100px rgba(0,0,0,0.9);
            position: relative;
        }
        .card.active { display: flex; animation: slideUp 0.6s ease-out; }

        /* 文章总标题 */
        .main-title {
            font-size: 2.2rem; color: #fff; text-align: center; margin-bottom: 10px;
            letter-spacing: 10px; font-weight: 900; text-shadow: 0 0 20px var(--accent);
        }

        .card-header {
            font-size: 1.4rem; color: var(--accent); margin-bottom: 30px; letter-spacing: 4px;
            text-align: center; border-bottom: 1px solid rgba(0, 242, 255, 0.1); padding-bottom: 15px;
            position: relative;
        }

        /* 回跳按钮 */
        .jump-btn {
            position: absolute; right: 0; top: 0; background: none; border: 1px solid var(--accent);
            color: var(--accent); padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem;
            transition: 0.3s;
        }
        .jump-btn:hover { background: var(--accent); color: #000; }

        .card-content { flex: 1; overflow-y: auto; padding-right: 15px; scrollbar-width: none; scroll-behavior: smooth; }
        .card-content::-webkit-scrollbar { width: 0; }

        .rhythm-block { margin-bottom: 60px; line-height: 2.5; font-size: 1.5rem; text-align: justify; }
        .rhythm-block::first-letter { font-size: 3rem; font-weight: bold; color: var(--accent); margin-right: 12px; text-shadow: 0 0 20px var(--accent); }

        .btn-page { background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 12px 60px; border-radius: 100px; cursor: pointer; font-weight: bold; margin: 30px auto 0; display: block; }

        /* 左下角调音台 */
        #mixer {
            position: fixed; bottom: 30px; left: 30px; background: rgba(0, 0, 0, 0.8);
            padding: 20px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); width: 280px; z-index: 100;
        }
        .mixer-grid { display: grid; grid-template-columns: 1fr; gap: 6px; margin-top: 10px; }
        .m-btn { background: rgba(255,255,255,0.05); border: none; color: #777; padding: 10px; border-radius: 10px; cursor: pointer; text-align: left; font-size: 0.75rem; }
        .m-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        /* 右下角 Diablo.Hulu 名片 */
        #profile-card {
            position: fixed; bottom: 30px; right: 30px; width: 320px;
            background: #fff; color: #333; padding: 20px; border-radius: 20px;
            display: flex; align-items: center; gap: 15px; z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: opacity 1s ease, transform 1s ease;
        }
        #profile-card.hide { opacity: 0; transform: translateY(20px); pointer-events: none; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; background: #eee; object-fit: cover; border: 2px solid var(--accent); }
        .profile-info h4 { font-size: 1rem; margin-bottom: 4px; color: #000; }
        .profile-info p { font-size: 0.7rem; color: #666; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="bg-scroll"></div>
    <div class="grid-overlay"></div>
    <div id="app"></div>

    <div id="mixer">
        <div style="font-size: 0.6rem; color: #555; letter-spacing: 2px;">RHYTHM CONSOLE</div>
        <div class="mixer-grid">
            <button class="m-btn" onclick="togglePulse('deep_bass')">○ 深度脉冲 (Sub-Bass)</button>
            <button class="m-btn" onclick="togglePulse('latin_bass')">◇ 拉丁循环 (Latin-Bass)</button>
            <button class="m-btn" onclick="togglePulse('reggaeton')">◆ 雷击顿风格 (Dembow)</button>
            <button class="m-btn" onclick="togglePulse('full_mix')">★ 全能律动 (Full)</button>
            <button class="m-btn" onclick="togglePulse('square_skit')" alt="这是修改于Sonic Pi-S.A的歌曲">⚡ Square Skit (Sam Aaron)</button>
            <button class="m-btn" onclick="togglePulse('tilburg_2')" alt="这是修改于Sonic Pi-S.A的歌曲">⚡ Tilburg 2 (Sam Aaron)</button>
            <button class="m-btn" onclick="stopAudio()" style="opacity:0.3">■ 静止</button>
        </div>
    </div>

    <!-- 个人名片 -->
    <div id="profile-card" class="hide">
        <img src="https://i0.hdslb.com/bfs/face/ebbc2180b91f59be51782c9dd37c2315d8db6706.jpg@128w_128h_1c_1s.webp" class="avatar" alt="Diablos.Hulu">
        <div class="profile-info">
            <h4>Diablos.Hulu</h4>
            <p>此模式仅供自己阅读，如果您喜欢随缘赞叹，如果您不喜欢，我也不接受批判。</p>
        </div>
    </div>

<script>
    const rawData = `第一会：南无萨怛他。苏伽多耶。阿囉訶帝。三藐三菩陀寫。南無薩怛他。佛陀俱知。瑟尼釤。南無薩婆勃陀勃地。薩跢鞞弊。南無薩多南。三藐三菩陀。俱知南。娑舍囉婆迦。僧伽喃。南無盧雞阿羅漢跢喃。南無蘇盧多波那喃。南無娑羯唎陀伽彌喃。南無盧雞三藐伽跢喃。三藐伽波囉。底波多那喃。南無提婆離瑟赧。南無悉陀耶。毗地耶。陀囉離瑟赧。舍波奴揭囉訶。 娑訶娑囉摩他喃。南無跋囉訶摩泥。南無因陀囉耶。南無婆伽婆帝。嚧陀囉耶。烏摩般帝。娑醯夜耶。南無婆伽婆帝。那囉野拏耶。槃遮摩訶三慕陀囉。南無悉羯唎多耶。南無婆伽婆帝。摩訶迦囉耶。地唎般剌那伽囉。毗陀囉波拏迦囉耶。阿地目帝。屍摩舍那泥婆悉泥。摩怛唎伽拏。南無悉羯唎多耶。南無婆伽婆帝。多他伽跢俱囉耶。南無般頭摩俱囉耶。南無跋闍囉俱囉耶。南無摩尼俱囉耶。南無伽闍俱囉耶。南無婆伽婆帝。帝唎茶。輸囉西那。波囉訶囉拏囉闍耶。跢他伽多耶。南無婆伽婆帝。南無阿彌多婆耶。跢他伽多耶。阿囉訶帝。三藐三菩陀耶。南無婆伽婆帝。阿芻毗耶。跢他伽多耶。阿囉訶帝。三藐三菩陀耶。南無婆伽婆帝。鞞沙闍耶。俱嚧吠柱唎耶。般囉婆囉闍耶。跢他伽多耶。南無婆伽婆帝。三補師毖多。薩憐捺囉剌闍耶。跢他伽多耶。阿囉訶帝。三藐三菩陀耶。南無婆伽婆帝。舍雞野母那曳。跢他伽多耶。阿囉訶帝。三藐三菩陀耶。南無婆伽婆帝。剌怛那雞都囉闍耶。跢他伽多耶。阿囉訶帝。三藐三菩陀耶。帝瓢。南無薩羯唎多。翳曇婆伽婆多。薩怛他伽都瑟尼釤。薩怛多般怛㘕。南無阿婆囉視耽。般囉帝。揚岐囉。薩囉婆。部多揭囉訶。尼羯囉訶。揭迦囉訶尼。跋囉毖地耶。叱陀你。阿迦囉。蜜唎柱。般唎怛囉耶。寧羯唎。薩囉婆。槃陀那。目叉尼。薩囉婆。突瑟吒。突悉乏。般那你。伐囉尼。赭都囉。失帝南。羯囉訶。娑訶薩囉若闍。毗多崩娑那羯唎。阿瑟吒冰舍帝南。那叉剎怛囉若闍。波囉薩陀那羯唎。阿瑟吒南。摩訶揭囉訶若闍。毗多崩薩那羯唎。薩婆舍都嚧。你婆囉若闍。呼藍突悉乏。难遮那舍尼。毖沙舍。悉怛囉。阿吉尼。烏陀迦囉若闍。阿般囉視多具囉。摩訶般囉戰持。摩訶疊多。摩訶帝闍。摩訶稅多闍婆羅。摩訶跋羅槃陀囉。婆悉你。阿唎耶多囉。毗唎俱知。誓婆毗闍耶。跋闍囉摩禮底。毗舍嚧多。勃騰罔迦。跋闍囉制喝那阿遮。摩囉制婆。般囉質多。跋闍囉擅持。毗舍囉遮。扇多舍。鞞提婆。補視多。蘇摩嚧波。摩訶稅多。阿唎耶多囉。摩訶婆囉阿般囉。跋闍囉商羯囉制婆。跋闍囉俱摩唎。俱藍陀唎。跋闍囉喝薩多遮。毗地耶。乾遮那。摩唎迦。啒蘇母。婆羯囉跢那。鞞嚧遮那俱唎耶。夜囉菟。瑟尼釤。毗折藍婆摩尼遮。跋闍囉迦那迦波囉婆。嚧闍那。跋闍囉頓稚遮。稅多遮。迦摩囉。剎奢屍。波囉婆。翳帝夷帝。母陀囉羯拏。娑鞞囉懺。掘梵都。印菟那麼麼寫。
第二会：烏𤙖。唎瑟揭拏。般剌舍悉多。薩怛他。伽都瑟尼釤。虎𤙖。都嚧雍。瞻婆那。虎𤙖。都嚧雍。悉耽婆那。虎𤙖。都嚧雍。波囉瑟地耶。三般叉拏羯囉。虎𤙖。都嚧雍。薩婆藥叉。喝囉剎婆。揭囉訶若闍。毗騰崩薩。那羯囉。虎𤙖。都嚧雍。者都囉。屍底南。揭囉訶。娑訶薩囉南。毗騰崩薩那囉。虎𤙖。都嚧雍。囉叉。婆伽梵。薩怛他。伽都瑟尼釤。波囉點闍吉唎。摩訶娑訶薩囉。勃樹娑訶薩囉。室唎沙。俱知娑訶薩泥。帝㘑。阿弊提視婆唎多。吒吒甖迦。摩訶跋闍嚧陀囉。帝唎菩婆那。曼茶囉。烏𤙖。莎悉帝。薄婆都。麼麼。印菟那麼麼寫。
第三会：囉闍婆夜。主囉婆夜。阿祗尼婆夜。烏陀迦婆夜。毗沙婆夜。舍薩多囉婆夜。婆囉斫羯囉婆夜。突瑟叉婆夜。阿舍你婆夜。阿迦囉蜜唎柱婆夜。陀囉尼部彌劍。波伽波陀婆夜。烏囉迦婆多婆夜。剌闍壇茶婆夜。那伽婆夜。毗條怛婆夜。蘇波囉拏婆夜。藥叉揭囉訶。囉叉私揭囉訶。畢唎多揭囉訶。毗舍遮揭囉訶。部多揭囉訶。鳩槃茶揭囉訶。補丹那揭囉訶。迦吒補丹那揭囉訶。悉乾度揭囉訶。阿播悉摩囉揭囉訶。烏檀摩陀揭囉訶。車夜揭囉訶。醯唎婆帝揭囉訶。社多訶唎喃。揭婆訶唎喃。嚧地囉訶唎喃。忙娑訶唎喃。謎陀訶唎喃。摩闍訶唎喃。闍多訶唎女。視比多訶唎喃。毗多訶唎喃。婆多訶唎喃。阿輸遮訶唎女。質多訶唎女。帝釤薩鞞釤。薩婆揭囉訶南。毗陀耶闍。嗔陀夜彌。雞囉夜彌。波唎跋囉者迦。訖唎擔。毗陀夜闍。嗔陀夜彌。雞囉夜彌。茶演尼。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。摩訶般輸。般怛夜。嚧陀囉。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。那囉夜拏。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。怛埵伽嚧茶西。訖唎擔。毗陀耶闍。瞋陀夜彌。雞囉夜彌。摩訶迦囉。摩怛唎伽拏。訖唎擔。毗陀夜闍。嗔陀夜彌。雞囉夜彌。迦婆唎迦。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。闍耶羯囉。摩度羯囉。薩婆囉他。娑達那。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。赭咄囉婆耆你。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。毗唎羊訖唎知。難陀雞沙囉。伽拏般帝。索醯夜。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。那揭那舍囉婆拏。訖唎擔。毗陀夜闍。嗔陀夜彌。雞囉夜彌。阿羅漢。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。毗多囉伽。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。跋闍囉波你。具醯夜具醯夜。迦地般帝。訖唎擔。毗陀夜闍。瞋陀夜彌。雞囉夜彌。囉叉罔。婆伽梵。印兔那麼麼寫。
第四会：婆伽梵。薩怛多般怛囉。南無粹都帝。阿悉多那囉剌迦。波囉婆悉普吒。毗迦薩怛多鉢帝唎。什佛囉什佛囉。陀囉陀囉。頻陀囉頻陀罗。瞋陀瞋陀。虎𤙖。虎𤙖。泮吒。泮吒泮吒泮吒泮吒。娑訶。醯醯泮。阿牟迦耶泮。阿波囉提訶多泮。婆囉波囉陀泮。阿素囉毗陀囉波迦泮。薩婆提鞞弊泮。薩婆那伽弊泮。薩婆藥叉弊泮。薩婆乾闥婆弊泮。薩婆補丹那弊泮。迦吒補丹那弊泮。薩婆突狼枳帝弊泮。薩婆突澀比𠼐。訖瑟帝弊泮。薩婆什婆𠼐弊泮。薩婆阿播悉摩𠼐弊泮。薩婆舍囉婆拏弊泮。薩婆地帝雞弊泮。薩婆怛摩陀繼弊泮。薩婆毗陀耶。囉誓遮𠼐弊泮。闍夜羯囉。摩度羯囉。薩婆囉他娑陀雞弊泮。毗地夜。遮𠼐弊泮。者都囉。縛耆你弊泮。跋闍囉。俱摩唎。毗陀夜。囉誓弊泮。摩訶波囉丁羊。義耆唎弊泮。跋闍囉。商羯囉夜。波囉丈耆囉闍耶泮。摩訶迦囉夜。摩訶末怛唎迦拏。南無娑羯唎多夜泮。毖瑟拏婢曳泮。勃囉訶牟尼曳泮。阿耆尼曳泮。摩訶羯唎曳泮。羯囉檀遲曳泮。蔑怛唎曳泮。嘮怛唎曳泮。遮文茶曳泮。羯邏囉怛唎曳泮。迦般唎曳泮。阿地目質多。迦屍摩舍那。婆私你曳泮。演吉質。薩埵婆寫。麼麼印兔那麼麼寫。
第五会：突瑟吒質多。阿末怛唎質多。烏闍訶囉。伽婆訶囉。嚧地囉訶囉。婆娑訶囉。摩闍訶囉。闍多訶囉。視毖多訶囉。跋略夜訶囉。乾陀訶囉。布史波訶囉。頗囉訶囉。婆寫訶囉。般波質多。突瑟吒質多。嘮陀囉質多。药叉揭囉訶。囉剎娑揭囉訶。閉㘑多揭囉訶。閉舍遮揭囉訶。部多揭囉訶。鳩槃茶揭囉訶。悉乾陀揭囉訶。烏怛陀摩揭囉訶。車夜揭囉訶。阿播薩摩囉揭囉訶。宅祛革茶耆尼揭囉訶。唎佛帝揭囉訶。闍彌迦揭囉訶。舍俱尼揭囉訶。姥陀囉難地迦揭囉訶。阿藍婆揭囉訶。乾度波尼揭囉訶。什伐囉。堙迦醯迦。墜帝藥迦。怛隸帝藥迦。者突託迦。昵提什伐囉。毖釤摩什伐囉。薄底迦。鼻底迦。室隸瑟蜜迦。娑你般帝迦。薩婆什伐囉。室嚧吉帝。末陀鞞達嚧制劍。阿綺嚧鉗。目佉嚧鉗。羯唎突嚧鉗。揭囉訶揭藍羯拏輸藍。憚多輸藍。迄唎夜輸藍。末麼輸藍。跋唎室婆輸藍。毖栗瑟吒輸藍。烏陀囉輸藍。羯知輸藍。跋悉帝輸藍。鄔嚧輸藍。常迦輸藍。喝悉多輸藍。跋陀輸藍。娑房盎伽般囉丈伽輸藍。部多毖跢茶。茶耆尼。什婆囉。陀突嚧迦。建咄嚧吉知。婆路多毗。薩般嚧訶凌伽。輸沙怛囉。娑那羯囉。毗沙喻迦。阿耆尼。烏陀迦。末囉鞞囉建跢囉。阿迦囉。蜜唎咄。怛歛部迦。地栗剌吒。毖唎瑟質迦。薩婆那俱囉。肆引伽弊。揭囉唎藥叉。怛囉芻。末囉視。吠帝釤。娑鞞釤。悉怛多鉢怛囉。摩訶跋闍嚧。瑟尼釤。摩訶般賴丈耆藍。夜波突陀舍喻闍那。辮怛隸拏。毗陀耶。槃曇迦嚧彌。帝殊。槃曇迦嚧彌。般囉毗陀。槃曇迦嚧彌。哆姪他。唵。阿那隸。毗舍提。鞞囉。跋闍囉。陀唎。槃陀。槃陀你。跋闍囉。謗尼泮。虎𤙖。都嚧甕泮。娑婆訶。`;

    function init() {
        const stage = document.getElementById('app');
        const lines = rawData.trim().split('\n');
        const pattern = [4, 6, 8];

        lines.forEach((line, idx) => {
            const [title, body] = line.split('：');
            const sentences = body.split('。').filter(s => s.trim());
            let html = '', sIdx = 0, pIdx = 0;
            while(sIdx < sentences.length) {
                let count = pattern[pIdx % 3];
                html += `<div class="rhythm-block">${sentences.slice(sIdx, sIdx + count).join('。')}。</div>`;
                sIdx += count; pIdx++;
            }
            const card = document.createElement('div');
            card.className = `card ${idx === 0 ? 'active' : ''}`;
            card.id = `card-${idx}`;
            card.innerHTML = `
                <h1 class="main-title">首楞严咒</h1>
                <div class="card-header">
                    ${title}
                    <button class="jump-btn" onclick="jumpToFirst(${idx})">返回起句</button>
                </div>
                <div class="card-content" id="content-${idx}">${html}</div>
                <button class="btn-page" onclick="goNext(${idx + 1 >= lines.length ? 0 : idx + 1})">下一会</button>
            `;
            stage.appendChild(card);
        });
        checkProfile();
    }

    function jumpToFirst(idx) {
        if(idx === 4) { // 第五会跳转到第一会
            goNext(0);
            setTimeout(() => { document.getElementById('content-0').scrollTop = 0; }, 100);
        } else {
            document.getElementById(`content-${idx}`).scrollTop = 0;
        }
    }

    function goNext(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        document.getElementById(`card-${id}`).classList.add('active');
    }

    // 名片缓存逻辑
    function checkProfile() {
        const hasSeen = localStorage.getItem('diablo_seen');
        if (!hasSeen) {
            const pc = document.getElementById('profile-card');
            pc.classList.remove('hide');
            setTimeout(() => {
                pc.classList.add('hide');
                localStorage.setItem('diablo_seen', 'true');
            }, 7000);
        }
    }

  
    let ctx = null, master = null, timer = null, nextTime = 0, step = 0, mode = null;

    function initAudio() {
        if (ctx) return;
        ctx = new (window.AudioContext || window.webkitAudioContext)();
        master = ctx.createGain();
        const comp = ctx.createDynamicsCompressor();
        comp.threshold.value = -18; master.connect(comp); comp.connect(ctx.destination);
    }

    const Synth = {
        kick(t, vol = 0.8) {
            const o = ctx.createOscillator(); const g = ctx.createGain();
            o.frequency.setValueAtTime(150, t); o.frequency.exponentialRampToValueAtTime(40, t + 0.1);
            g.gain.setValueAtTime(vol, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
            o.connect(g); g.connect(master); o.start(t); o.stop(t + 0.4);
        },
        square(t, f, vol = 0.2) {
            const o = ctx.createOscillator(); const g = ctx.createGain(); const fil = ctx.createBiquadFilter();
            o.type = 'square'; o.frequency.setValueAtTime(f, t);
            fil.type = 'lowpass'; fil.frequency.setValueAtTime(1200, t);
            g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(vol, t + 0.05); g.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
            o.connect(fil); fil.connect(g); g.connect(master); o.start(t); o.stop(t + 0.45);
        },
        snare(t, vol = 0.3) {
            const buf = ctx.createBuffer(1, ctx.sampleRate * 0.1, ctx.sampleRate); const data = buf.getChannelData(0);
            for(let i=0; i<data.length; i++) data[i] = Math.random() * 2 - 1;
            const s = ctx.createBufferSource(); s.buffer = buf; const g = ctx.createGain();
            g.gain.setValueAtTime(vol, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
            s.connect(g); g.connect(master); s.start(t);
        },
        bass(t, f, vol = 0.6) {
            const o = ctx.createOscillator(); const g = ctx.createGain();
            o.frequency.setValueAtTime(f, t); g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(vol, t + 0.01); g.gain.exponentialRampToValueAtTime(0.001, t + 0.5);
            o.connect(g); g.connect(master); o.start(t); o.stop(t + 0.5);
        }
    };

    const Patterns = {
        deep_bass: (t, s) => { if(s%2===0) Synth.bass(t, 50); if(s%16===0) Synth.kick(t); },
        latin_bass: (t, s) => { if(s%4===0) Synth.kick(t); if(s%4===2||s%4===3) Synth.bass(t, 70, 0.4); },
        reggaeton: (t, s) => { if(s%8===0||s%8===4) Synth.kick(t); if(s%8===3||s%8===6) Synth.snare(t); },
        full_mix: (t, s) => { if(s%4===0) Synth.kick(t); if(s%2===0) Synth.bass(t, 45, 0.4); if(s%16===7) Synth.snare(t); },
        
        square_skit: (t, s) => {
            if (s % 2 === 0) Synth.kick(t, 0.7); // bd_haus
            const notes = [65.41, 65.41, 41.20, 174.61]; // C2, C2, E1, F3
            if (s % 2 === 0) { Synth.square(t, notes[Math.floor(s/2) % 4]); }
        },
        tilburg_2: (t, s) => {
            if (s % 4 === 0) Synth.kick(t, 1.0);
            const ePent = [82.41, 123.47, 164.81];
            Synth.bass(t, ePent[Math.floor(Math.random()*3)], 0.2);
        }
    };

    function scheduler() {
        while(nextTime < ctx.currentTime + 0.1) {
            if(Patterns[mode]) Patterns[mode](nextTime, step);
            nextTime += 0.25; step++;
        }
        timer = setTimeout(scheduler, 25);
    }

    function togglePulse(m) {
        initAudio(); if(mode === m) return stopAudio();
        stopAudio(); mode = m; step = 0; nextTime = ctx.currentTime; scheduler();
        event.target.classList.add('active');
    }

    function stopAudio() {
        clearTimeout(timer); mode = null;
        document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
    }

    init();
</script>
</body>
</html>